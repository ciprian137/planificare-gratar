<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator Grătar - Planificator Simplificat</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); /* Gri închis la negru */
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #ecf0f1; /* Text deschis pentru fundal închis */
        }

        .container {
            max-width: 1400px; /* Lățime mai mare pentru mai mult spațiu */
            margin: 0 auto;
            background: #f8f9fa; /* Fundal deschis pentru conținut */
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            color: #333; /* Text închis pentru conținut deschis */
        }

        .header {
            background: linear-gradient(135deg, #34495e, #2c3e50); /* Gradient gri închis */
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin-top: 10px;
            font-size: 1.1em;
            color: #bdc3c7;
        }

        .action-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* Permite butoanelor să se așeze pe rândul următor */
        }

        .action-buttons button {
            background: #555;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .action-buttons button:hover {
            background: #777;
            transform: translateY(-2px);
        }

        .content {
            padding: 30px;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #eceff1; /* Gri foarte deschis */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input,
        .input-group select { /* Select-ul rămâne, dar nu va fi folosit pentru profil */
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: white;
            color: #333;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #6a82fb; /* O nuanță de albastru/violet */
            box-shadow: 0 0 0 3px rgba(106, 130, 251, 0.2);
        }

        .tables-grid-container {
            display: grid;
            grid-template-columns: 1fr; /* Doar o singură coloană */
            gap: 30px; /* Spațiu între secțiunile de tabel */
            margin-bottom: 30px;
        }

        .table-section {
            background: #eceff1; /* Gri foarte deschis */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .table-section h3 {
            margin-top: 0;
            color: #333;
            text-align: center;
            font-size: 1.3em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #cfd8dc; /* Linie sub titlu */
        }

        .add-btn {
            background: #28a745; /* Verde */
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .add-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #dc3545; /* Roșu */
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            color: #333;
            white-space: nowrap; /* Previne ruperea textului în coloane */
        }

        th {
            background: #555; /* Gri închis pentru antet */
            color: white;
            font-weight: bold;
            cursor: pointer; /* Pentru sortare */
        }

        th:hover {
            background: #666;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .editable-input,
        .price-input,
        .quantity-input,
        .notes-input { /* profile-select și time-input eliminate */
            width: calc(100% - 8px);
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            color: #333;
        }

        .editable-input:focus,
        .price-input:focus,
        .quantity-input:focus,
        .notes-input:focus { /* profile-select și time-input eliminate */
            outline: none;
            border-color: #6a82fb;
            box-shadow: 0 0 0 2px rgba(106, 130, 251, 0.2);
        }

        .price-input, .quantity-input { /* time-input eliminat */
            text-align: center;
        }

        .total-price {
            font-weight: bold;
            color: #27ae60;
        }

        .quantity {
            font-weight: bold;
            color: #e74c3c;
        }

        .budget-summary {
            background: linear-gradient(135deg, #34495e, #2c3e50); /* Gradient gri închis */
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .budget-summary h3 {
            margin: 0 0 15px 0;
            font-size: 1.5em;
            color: #ecf0f1;
        }

        .budget-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }

        .remaining-budget {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.2);
            color: white;
        }

        .warning {
            background: #c0392b !important; /* Roșu mai închis */
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px rgba(192, 57, 43, 0.5) !important;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }

        .action-cell {
            width: 100px; /* Lățime ajustată */
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container" id="gratarPlanContainer">
        <div class="header">
            <h1>🔥 Calculator Grătar - Planificator Simplificat 🔥</h1>
            <p>Gestionează-ți lista de grătar în timp real și salvează-ți planurile!</p>
            <div class="action-buttons">
                <button onclick="salveazaPlanCaImagine()">📸 Salvează Plan (Imagine)</button>
                <button onclick="genereazaListaCumparaturiSiDescarca()">🛒 Generează Listă Cumpărături</button>
            </div>
        </div>

        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <label for="persoane">Numărul de persoane:</label>
                    <input type="number" id="persoane" value="28" min="1" max="100">
                </div>
                <div class="input-group">
                    <label for="buget">Buget total (LEI):</label>
                    <input type="number" id="buget" value="1200" min="0" step="0.01">
                </div>
                </div>

            <div class="tables-grid-container">
                <div class="table-section">
                    <h3>🥩 Carne și Preparate <button class="add-btn" onclick="adaugaProdus('carne')">+ Adaugă</button></h3>
                    <table id="carneTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('carne', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('carne', 'cantitate')">Cantitate</th>
                                <th onclick="sorteazaTabel('carne', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('carne', 'pret')">Preț</th>
                                <th>Am Acasă</th>
                                <th>Notițe</th>
                                <th>Total</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>🥗 Legume și Fructe <button class="add-btn" onclick="adaugaProdus('legume')">+ Adaugă</button></h3>
                    <table id="legumeTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('legume', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('legume', 'cantitate')">Cantitate</th>
                                <th onclick="sorteazaTabel('legume', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('legume', 'pret')">Preț</th>
                                <th>Am Acasă</th>
                                <th>Notițe</th>
                                <th>Total</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>🍺 Băuturi și Alcool <button class="add-btn" onclick="adaugaProdus('bauturi')">+ Adaugă</button></h3>
                    <table id="bauturiTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('bauturi', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('bauturi', 'cantitate')">Cantitate</th>
                                <th onclick="sorteazaTabel('bauturi', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('bauturi', 'pret')">Preț</th>
                                <th>Am Acasă</th>
                                <th>Notițe</th>
                                <th>Total</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>🍽️ Accesorii și Diverse <button class="add-btn" onclick="adaugaProdus('condimente')">+ Adaugă</button></h3>
                    <table id="condimenteTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('condimente', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('condimente', 'cantitate')">Cantitate</th>
                                <th onclick="sorteazaTabel('condimente', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('condimente', 'pret')">Preț</th>
                                <th>Am Acasă</th>
                                <th>Notițe</th>
                                <th>Total</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="budget-summary" id="budgetSummary">
                <h3>📊 Sumar Buget</h3>
                <div class="budget-row">
                    <span>Buget total:</span>
                    <span id="totalBuget">1200.00 LEI</span>
                </div>
                <div class="budget-row">
                    <span>Total cheltuieli (est. necesar):</span>
                    <span id="totalCheltuieli">0.00 LEI</span>
                </div>
                <div class="remaining-budget">
                    <div class="budget-row">
                        <span>Bani rămași:</span>
                        <span id="baniRamasi">1200.00 LEI</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let produse = {
            carne: [
                { nume: "Mici", cantitate: 0.2, unitate: "kg", pret: 25, am_acasa: false, notite: "" },
                { nume: "Ceafă de porc", cantitate: 0.5, unitate: "buc", pret: 25, am_acasa: false, notite: "" },
                { nume: "Pulpe dezosate de pui", cantitate: 0.25, unitate: "kg", pret: 16, am_acasa: false, notite: "" },
                { nume: "Cârnați de porc", cantitate: 0.2, unitate: "kg", pret: 18, am_acasa: false, notite: "" }
            ],
            legume: [
                { nume: "Ceapă", cantitate: 0.07, unitate: "buc", pret: 4, am_acasa: false, notite: "" },
                { nume: "Ciuperci brune", cantitate: 0.1, unitate: "kg", pret: 12, am_acasa: false, notite: "" },
                { nume: "Lămâi", cantitate: 0.3, unitate: "buc", pret: 8, am_acasa: false, notite: "" },
                { nume: "Lime", cantitate: 0.2, unitate: "buc", pret: 12, am_acasa: false, notite: "" },
                { nume: "Portocale", cantitate: 0.3, unitate: "buc", pret: 6, am_acasa: false, notite: "" }
            ],
            bauturi: [
                { nume: "Bere (bax)", cantitate: 0.18, unitate: "bax", pret: 35, am_acasa: false, notite: "" },
                { nume: "Bere fără alcool", cantitate: 0.2, unitate: "buc", pret: 4, am_acasa: false, notite: "" },
                { nume: "Cola (bax)", cantitate: 0.07, unitate: "bax", pret: 25, am_acasa: false, notite: "" },
                { nume: "Schweppes", cantitate: 0.32, unitate: "buc", pret: 5, am_acasa: false, notite: "" },
                { nume: "Apă (bidon 5L)", cantitate: 0.14, unitate: "buc", pret: 8, am_acasa: false, notite: "" },
                { nume: "Rom", cantitate: 0.2, unitate: "buc", pret: 35, am_acasa: false, notite: "" },
                { nume: "Jägermeister", cantitate: 0.07, unitate: "buc", pret: 65, am_acasa: false, notite: "" },
                { nume: "Tequila", cantitate: 0.03, unitate: "buc", pret: 45, am_acasa: false, notite: "" },
                { nume: "Gin", cantitate: 0.2, unitate: "buc", pret: 40, am_acasa: false, notite: "" }
            ],
            condimente: [
                { nume: "Pâine", cantitate: 0.36, unitate: "buc", pret: 4, am_acasa: false, notite: "" },
                { nume: "Muștar (borcan)", cantitate: 0.11, unitate: "buc", pret: 6, am_acasa: false, notite: "" },
                { nume: "Chipsuri/Semințe", cantitate: 0.2, unitate: "buc", pret: 8, am_acasa: false, notite: "" },
                { nume: "Gheață", cantitate: 0.3, unitate: "kg", pret: 5, am_acasa: false, notite: "" },
                { nume: "Carbuni (sac)", cantitate: 0.1, unitate: "buc", pret: 25, am_acasa: false, notite: "" },
                { nume: "Farfurii (set 50)", cantitate: 0.07, unitate: "set", pret: 15, am_acasa: false, notite: "" },
                { nume: "Pahare (set 50)", cantitate: 0.07, unitate: "set", pret: 12, am_acasa: false, notite: "" },
                { nume: "Role bucătărie", cantitate: 0.14, unitate: "buc", pret: 8, am_acasa: false, notite: "" },
                { nume: "Saci gunoi mari", cantitate: 0.14, unitate: "buc", pret: 12, am_acasa: false, notite: "" }
            ]
        };

        // Multiplicatorul de profil a fost eliminat complet. Acum cantitatea per persoana * nr_persoane
        function calculeazaCantitateTotala(cantitate_per_pers, nr_persoane) {
            const total = cantitate_per_pers * nr_persoane;
            // Rotunjire în sus pentru a asigura suficiente produse, cu 2 zecimale pentru valori sub 1
            return total < 1 ? total.toFixed(2) : Math.ceil(total * 100) / 100; // Rotunjire la 2 zecimale pt numere mari
        }

        function actualizeazaTabela(tabelId, produse_categorie, categoria) {
            const tabel = document.getElementById(tabelId);
            const tbody = tabel.querySelector('tbody');
            const nr_persoane = parseInt(document.getElementById('persoane').value) || 0;

            tbody.innerHTML = '';

            produse_categorie.forEach((produs, index) => {
                const cantitateCalculata = calculeazaCantitateTotala(produs.cantitate, nr_persoane);
                const totalProdus = (cantitateCalculata * produs.pret).toFixed(2);

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><input type="text" class="editable-input" value="${produs.nume}" onchange="actualizeazaProprietate('${categoria}', ${index}, 'nume', this.value)"></td>
                    <td><input type="number" class="quantity-input" value="${produs.cantitate}" step="0.01" onchange="actualizeazaProprietate('${categoria}', ${index}, 'cantitate', parseFloat(this.value) || 0)"></td>
                    <td><input type="text" class="editable-input" value="${produs.unitate}" onchange="actualizeazaProprietate('${categoria}', ${index}, 'unitate', this.value)"></td>
                    <td><input type="number" class="price-input" value="${produs.pret}" step="0.01" onchange="actualizeazaProprietate('${categoria}', ${index}, 'pret', parseFloat(this.value) || 0)"></td>
                    <td><input type="checkbox" onchange="actualizeazaProprietate('${categoria}', ${index}, 'am_acasa', this.checked)" ${produs.am_acasa ? 'checked' : ''}></td>
                    <td><input type="text" class="notes-input" value="${produs.notite}" onchange="actualizeazaProprietate('${categoria}', ${index}, 'notite', this.value)"></td>
                    <td class="total-price">${totalProdus} LEI</td>
                    <td class="action-cell"><button class="delete-btn" onclick="stergeProdus('${categoria}', ${index})">Șterge</button></td>
                `;
            });
        }

        function actualizeazaProprietate(categoria, index, proprietate, valoareNoua) {
            produse[categoria][index][proprietate] = valoareNoua;
            actualizeazaToate();
        }

        function adaugaProdus(categoria) {
            // Profilul inițial a fost eliminat, noul produs are cantitatea direct
            const produs = {
                nume: "Produs nou",
                cantitate: 0.1, // Cantitate per persoana
                unitate: "buc",
                pret: 1,
                am_acasa: false,
                notite: ""
            };
            produse[categoria].push(produs);
            actualizeazaToate();
        }

        function stergeProdus(categoria, index) {
            if (confirm('Sigur vrei să ștergi acest produs?')) {
                produse[categoria].splice(index, 1);
                actualizeazaToate();
            }
        }

        function calculeazaTotalCheltuieli() {
            const nr_persoane = parseInt(document.getElementById('persoane').value) || 0;
            let total = 0;

            Object.values(produse).forEach(categorie => {
                categorie.forEach(produs => {
                    if (!produs.am_acasa) { // Include doar produsele care nu sunt "acasă"
                        const cantitateCalculata = calculeazaCantitateTotala(produs.cantitate, nr_persoane);
                        total += cantitateCalculata * produs.pret;
                    }
                });
            });
            return total;
        }

        function actualizeazaBuget() {
            const bugetTotal = parseFloat(document.getElementById('buget').value) || 0;
            const totalCheltuieli = calculeazaTotalCheltuieli();
            const baniRamasi = bugetTotal - totalCheltuieli;

            document.getElementById('totalBuget').textContent = `${bugetTotal.toFixed(2)} LEI`;
            document.getElementById('totalCheltuieli').textContent = `${totalCheltuieli.toFixed(2)} LEI`;
            document.getElementById('baniRamasi').textContent = `${baniRamasi.toFixed(2)} LEI`;

            const budgetSummary = document.getElementById('budgetSummary');
            if (baniRamasi < 0) {
                budgetSummary.classList.add('warning');
            } else {
                budgetSummary.classList.remove('warning');
            }
        }

        function actualizeazaToate() {
            actualizeazaTabela('carneTable', produse.carne, 'carne');
            actualizeazaTabela('legumeTable', produse.legume, 'legume');
            actualizeazaTabela('bauturiTable', produse.bauturi, 'bauturi');
            actualizeazaTabela('condimenteTable', produse.condimente, 'condimente');
            actualizeazaBuget();
        }

        function sorteazaTabel(categoria, cheie) {
            produse[categoria].sort((a, b) => {
                if (typeof a[cheie] === 'string') {
                    return a[cheie].localeCompare(b[cheie]);
                }
                return a[cheie] - b[cheie];
            });
            actualizeazaTabela(categoria + 'Table', produse[categoria], categoria);
        }

        // Funcția pentru salvarea planului ca imagine
        function salveazaPlanCaImagine() {
            const element = document.getElementById('gratarPlanContainer'); // Elementul pe care vrei să-l capturezi

            // Opțiuni pentru html2canvas (opțional, pentru control mai fin)
            const options = {
                scale: 2, // Mărește rezoluția pentru o calitate mai bună a imaginii
                useCORS: true, // Permite încărcarea imaginilor din surse externe, dacă există
                logging: false, // Dezactivează log-urile în consolă
                backgroundColor: '#f8f9fa' // Setează o culoare de fundal explicită
            };

            html2canvas(element, options).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const a = document.createElement('a');
                const date = new Date();
                const filename = `plan_gratar_${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}_${date.getHours().toString().padStart(2, '0')}${date.getMinutes().toString().padStart(2, '0')}.png`;
                a.href = imgData;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                alert('Planul a fost salvat ca imagine!');
            }).catch(error => {
                console.error('Eroare la salvarea imaginii:', error);
                alert('A apărut o eroare la salvarea planului ca imagine. Te rog să încerci din nou.');
            });
        }

        // Funcția pentru generarea și descărcarea listei de cumpărături
        function genereazaListaCumparaturiSiDescarca() {
            const nr_persoane = parseInt(document.getElementById('persoane').value) || 0;
            const lista = {};
            let totalLista = 0;
            let outputText = "--- Lista de Cumpărături Grătar ---\n\n";
            outputText += `Număr persoane: ${nr_persoane}\n\n`;

            Object.values(produse).forEach(categorie => {
                categorie.forEach(produs => {
                    if (!produs.am_acasa) { // Doar ce nu e deja "acasă"
                        const cantitateNecesara = parseFloat(calculeazaCantitateTotala(produs.cantitate, nr_persoane));
                        const pretTotalProdus = cantitateNecesara * produs.pret;

                        if (lista[produs.nume]) {
                            lista[produs.nume].cantitate += cantitateNecesara;
                            lista[produs.nume].pretTotal += pretTotalProdus;
                        } else {
                            lista[produs.nume] = {
                                cantitate: cantitateNecesara,
                                unitate: produs.unitate,
                                pretTotal: pretTotalProdus
                            };
                        }
                        totalLista += pretTotalProdus;
                    }
                });
            });

            // Adaugă produsele la textul final
            for (const numeProdus in lista) {
                const item = lista[numeProdus];
                outputText += `- ${numeProdus}: ${item.cantitate.toFixed(2)} ${item.unitate} (${item.pretTotal.toFixed(2)} LEI)\n`;
                if (item.notite) { // Adaugă notițele dacă există
                    outputText += `  (Notițe: ${item.notite})\n`;
                }
            }

            outputText += `\n--------------------------------------\n`;
            outputText += `Total estimat pentru cumpărături: ${totalLista.toFixed(2)} LEI\n`;
            outputText += `--------------------------------------\n`;

            // Creează și descarcă fișierul text
            const blob = new Blob([outputText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const date = new Date();
            const filename = `lista_cumparaturi_gratar_${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}.txt`;
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Event listeners
        document.getElementById('persoane').addEventListener('input', actualizeazaToate);
        document.getElementById('buget').addEventListener('input', actualizeazaBuget);

        // Inițializare
        actualizeazaToate();
    </script>
</body>
</html>
