<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator GrƒÉtar - Planificator Avansat</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); /* Gri √Ænchis la negru */
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #ecf0f1; /* Text deschis pentru fundal √Ænchis */
        }

        .container {
            max-width: 1400px; /* LƒÉ»õime mai mare pentru mai mult spa»õiu */
            margin: 0 auto;
            background: #f8f9fa; /* Fundal deschis pentru con»õinut */
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            color: #333; /* Text √Ænchis pentru con»õinut deschis */
        }

        .header {
            background: linear-gradient(135deg, #34495e, #2c3e50); /* Gradient gri √Ænchis */
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin-top: 10px;
            font-size: 1.1em;
            color: #bdc3c7;
        }

        .action-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* Permite butoanelor sƒÉ se a»ôeze pe r√¢ndul urmƒÉtor */
        }

        .action-buttons button {
            background: #555;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .action-buttons button:hover {
            background: #777;
            transform: translateY(-2px);
        }

        .content {
            padding: 30px;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #eceff1; /* Gri foarte deschis */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input,
        .input-group select {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: white;
            color: #333;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #6a82fb; /* O nuan»õƒÉ de albastru/violet */
            box-shadow: 0 0 0 3px rgba(106, 130, 251, 0.2);
        }

        /* ModificƒÉri pentru a afi»ôa tabelele unul sub altul */
        .tables-grid-container {
            display: grid;
            grid-template-columns: 1fr; /* Doar o singurƒÉ coloanƒÉ */
            gap: 30px; /* Spa»õiu √Æntre sec»õiunile de tabel */
            margin-bottom: 30px;
        }

        .table-section {
            background: #eceff1; /* Gri foarte deschis */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .table-section h3 {
            margin-top: 0;
            color: #333;
            text-align: center;
            font-size: 1.3em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #cfd8dc; /* Linie sub titlu */
        }

        .add-btn {
            background: #28a745; /* Verde */
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .add-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #dc3545; /* Ro»ôu */
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            color: #333;
            white-space: nowrap; /* Previne ruperea textului √Æn coloane */
        }

        th {
            background: #555; /* Gri √Ænchis pentru antet */
            color: white;
            font-weight: bold;
            cursor: pointer; /* Pentru sortare */
        }

        th:hover {
            background: #666;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .editable-input,
        .price-input,
        .quantity-input,
        .profile-select,
        .time-input,
        .notes-input { /* AdƒÉugat .notes-input */
            width: calc(100% - 8px);
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            color: #333;
        }

        .editable-input:focus,
        .price-input:focus,
        .quantity-input:focus,
        .profile-select:focus,
        .time-input:focus,
        .notes-input:focus {
            outline: none;
            border-color: #6a82fb;
            box-shadow: 0 0 0 2px rgba(106, 130, 251, 0.2);
        }

        .price-input, .quantity-input, .time-input {
            text-align: center;
        }

        .total-price {
            font-weight: bold;
            color: #27ae60;
        }

        .quantity {
            font-weight: bold;
            color: #e74c3c;
        }

        .budget-summary {
            background: linear-gradient(135deg, #34495e, #2c3e50); /* Gradient gri √Ænchis */
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .budget-summary h3 {
            margin: 0 0 15px 0;
            font-size: 1.5em;
            color: #ecf0f1;
        }

        .budget-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }

        .remaining-budget {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.2);
            color: white;
        }

        .warning {
            background: #c0392b !important; /* Ro»ôu mai √Ænchis */
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px rgba(192, 57, 43, 0.5) !important;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }

        .action-cell {
            width: 100px; /* LƒÉ»õime ajustatƒÉ */
            text-align: center;
        }

        /* Modal styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            color: #333;
        }

        .modal-content h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            max-height: 400px; /* Scroll for long lists */
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .modal-content li {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-content li:last-child {
            border-bottom: none;
        }

        .modal-content .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-content .close-button:hover,
        .modal-content .close-button:focus {
            color: #000;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Calculator GrƒÉtar - Planificator Avansat üî•</h1>
            <p>GestioneazƒÉ-»õi lista de grƒÉtar √Æn timp real »ôi salveazƒÉ-»õi planurile!</p>
            <div class="action-buttons">
                <button onclick="salveazaPlan()">üíæ SalveazƒÉ Plan</button>
                <button onclick="incarcaPlan()">üìÇ √éncarcƒÉ Plan</button>
                <button onclick="exportaJSON()">üì§ ExportƒÉ JSON</button>
                <button onclick="importaJSON()">üì• ImportƒÉ JSON</button>
                <button onclick="genereazaListaCumparaturi()">üõí GenereazƒÉ ListƒÉ CumpƒÉrƒÉturi</button>
            </div>
        </div>

        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <label for="persoane">NumƒÉrul de persoane:</label>
                    <input type="number" id="persoane" value="28" min="1" max="100">
                </div>
                <div class="input-group">
                    <label for="buget">Buget total (LEI):</label>
                    <input type="number" id="buget" value="1200" min="0" step="0.01">
                </div>
                <div class="input-group">
                    <label for="profilInitial">Profil cantitate nou produs:</label>
                    <select id="profilInitial">
                        <option value="normal">Normal</option>
                        <option value="mancacios">M√¢ncƒÉcios</option>
                        <option value="vegetarian">Vegetarian</option>
                        <option value="copil">Copil</option>
                    </select>
                </div>
            </div>

            <div class="tables-grid-container">
                <div class="table-section">
                    <h3>ü•© Carne »ôi Preparate <button class="add-btn" onclick="adaugaProdus('carne')">+ AdaugƒÉ</button></h3>
                    <table id="carneTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('carne', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('carne', 'cantitate_per_pers')">Cantitate/pers</th>
                                <th onclick="sorteazaTabel('carne', 'profil')">Profil Cantitate</th>
                                <th onclick="sorteazaTabel('carne', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('carne', 'pret')">Pre»õ</th>
                                <th onclick="sorteazaTabel('carne', 'timp_preparare')">Timp Prep. (min)</th>
                                <th>Am AcasƒÉ</th>
                                <th>Noti»õe</th>
                                <th>Total</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>ü•ó Legume »ôi Fructe <button class="add-btn" onclick="adaugaProdus('legume')">+ AdaugƒÉ</button></h3>
                    <table id="legumeTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('legume', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('legume', 'cantitate_per_pers')">Cantitate/pers</th>
                                <th onclick="sorteazaTabel('legume', 'profil')">Profil Cantitate</th>
                                <th onclick="sorteazaTabel('legume', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('legume', 'pret')">Pre»õ</th>
                                <th onclick="sorteazaTabel('legume', 'timp_preparare')">Timp Prep. (min)</th>
                                <th>Am AcasƒÉ</th>
                                <th>Noti»õe</th>
                                <th>Total</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>üç∫ BƒÉuturi »ôi Alcool <button class="add-btn" onclick="adaugaProdus('bauturi')">+ AdaugƒÉ</button></h3>
                    <table id="bauturiTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('bauturi', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('bauturi', 'cantitate_per_pers')">Cantitate/pers</th>
                                <th onclick="sorteazaTabel('bauturi', 'profil')">Profil Cantitate</th>
                                <th onclick="sorteazaTabel('bauturi', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('bauturi', 'pret')">Pre»õ</th>
                                <th onclick="sorteazaTabel('bauturi', 'timp_preparare')">Timp Prep. (min)</th>
                                <th>Am AcasƒÉ</th>
                                <th>Noti»õe</th>
                                <th>Total</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>üçΩÔ∏è Accesorii »ôi Diverse <button class="add-btn" onclick="adaugaProdus('condimente')">+ AdaugƒÉ</button></h3>
                    <table id="condimenteTable">
                        <thead>
                            <tr>
                                <th onclick="sorteazaTabel('condimente', 'nume')">Produs</th>
                                <th onclick="sorteazaTabel('condimente', 'cantitate_per_pers')">Cantitate/pers</th>
                                <th onclick="sorteazaTabel('condimente', 'profil')">Profil Cantitate</th>
                                <th onclick="sorteazaTabel('condimente', 'unitate')">Unitate</th>
                                <th onclick="sorteazaTabel('condimente', 'pret')">Pre»õ</th>
                                <th onclick="sorteazaTabel('condimente', 'timp_preparare')">Timp Prep. (min)</th>
                                <th>Am AcasƒÉ</th>
                                <th>Noti»õe</th>
                                <th>Total</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="budget-summary" id="budgetSummary">
                <h3>üìä Sumar Buget</h3>
                <div class="budget-row">
                    <span>Buget total:</span>
                    <span id="totalBuget">1200.00 LEI</span>
                </div>
                <div class="budget-row">
                    <span>Total cheltuieli (est. necesar):</span>
                    <span id="totalCheltuieli">0.00 LEI</span>
                </div>
                <div class="remaining-budget">
                    <div class="budget-row">
                        <span>Bani rƒÉma»ôi:</span>
                        <span id="baniRamasi">1200.00 LEI</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="shoppingListModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('shoppingListModal')">&times;</span>
            <h2>Lista de CumpƒÉrƒÉturi</h2>
            <ul id="shoppingListContent"></ul>
            <p><strong>Total estimat pentru cumpƒÉrƒÉturi: <span id="shoppingListTotal">0.00 LEI</span></strong></p>
        </div>
    </div>

    <script>
        let produse = {
            carne: [
                { nume: "Mici", cantitate_per_pers: 0.2, unitate: "kg", pret: 25, profil: "normal", timp_preparare: 30, am_acasa: false, notite: "" },
                { nume: "CeafƒÉ de porc", cantitate_per_pers: 0.5, unitate: "buc", pret: 25, profil: "normal", timp_preparare: 45, am_acasa: false, notite: "" },
                { nume: "Pulpe dezosate de pui", cantitate_per_pers: 0.25, unitate: "kg", pret: 16, profil: "normal", timp_preparare: 35, am_acasa: false, notite: "" },
                { nume: "C√¢rna»õi de porc", cantitate_per_pers: 0.2, unitate: "kg", pret: 18, profil: "normal", timp_preparare: 25, am_acasa: false, notite: "" }
            ],
            legume: [
                { nume: "CeapƒÉ", cantitate_per_pers: 0.07, unitate: "buc", pret: 4, profil: "normal", timp_preparare: 5, am_acasa: false, notite: "" },
                { nume: "Ciuperci brune", cantitate_per_pers: 0.1, unitate: "kg", pret: 12, profil: "normal", timp_preparare: 15, am_acasa: false, notite: "" },
                { nume: "LƒÉm√¢i", cantitate_per_pers: 0.3, unitate: "buc", pret: 8, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Lime", cantitate_per_pers: 0.2, unitate: "buc", pret: 12, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Portocale", cantitate_per_pers: 0.3, unitate: "buc", pret: 6, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" }
            ],
            bauturi: [
                { nume: "Bere (bax)", cantitate_per_pers: 0.18, unitate: "bax", pret: 35, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Bere fƒÉrƒÉ alcool", cantitate_per_pers: 0.2, unitate: "buc", pret: 4, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Cola (bax)", cantitate_per_pers: 0.07, unitate: "bax", pret: 25, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Schweppes", cantitate_per_pers: 0.32, unitate: "buc", pret: 5, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "ApƒÉ (bidon 5L)", cantitate_per_pers: 0.14, unitate: "buc", pret: 8, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Rom", cantitate_per_pers: 0.2, unitate: "buc", pret: 35, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "J√§germeister", cantitate_per_pers: 0.07, unitate: "buc", pret: 65, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Tequila", cantitate_per_pers: 0.03, unitate: "buc", pret: 45, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Gin", cantitate_per_pers: 0.2, unitate: "buc", pret: 40, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" }
            ],
            condimente: [
                { nume: "P√¢ine", cantitate_per_pers: 0.36, unitate: "buc", pret: 4, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Mu»ôtar (borcan)", cantitate_per_pers: 0.11, unitate: "buc", pret: 6, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Chipsuri/Semin»õe", cantitate_per_pers: 0.2, unitate: "buc", pret: 8, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Ghea»õƒÉ", cantitate_per_pers: 0.3, unitate: "kg", pret: 5, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Carbuni (sac)", cantitate_per_pers: 0.1, unitate: "buc", pret: 25, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Farfurii (set 50)", cantitate_per_pers: 0.07, unitate: "set", pret: 15, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Pahare (set 50)", cantitate_per_pers: 0.07, unitate: "set", pret: 12, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Role bucƒÉtƒÉrie", cantitate_per_pers: 0.14, unitate: "buc", pret: 8, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" },
                { nume: "Saci gunoi mari", cantitate_per_pers: 0.14, unitate: "buc", pret: 12, profil: "normal", timp_preparare: 0, am_acasa: false, notite: "" }
            ]
        };

        const profilMultiplicatori = {
            normal: 1,
            mancacios: 1.5,
            vegetarian: 0.5,
            copil: 0.6
        };

        function calculeazaCantitate(cantitate_per_pers, nr_persoane, profil) {
            const multiplicator = profilMultiplicatori[profil] || 1;
            const total = cantitate_per_pers * nr_persoane * multiplicator;
            return total < 1 ? total.toFixed(2) : Math.ceil(total * 10) / 10;
        }

        function actualizeazaTabela(tabelId, produse_categorie, categoria) {
            const tabel = document.getElementById(tabelId);
            const tbody = tabel.querySelector('tbody');
            const nr_persoane = parseInt(document.getElementById('persoane').value) || 0;

            tbody.innerHTML = '';

            produse_categorie.forEach((produs, index) => {
                const cantitateCalculata = calculeazaCantitate(produs.cantitate_per_pers, nr_persoane, produs.profil);
                const totalProdus = (cantitateCalculata * produs.pret).toFixed(2);

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><input type="text" class="editable-input" value="${produs.nume}" onchange="actualizeazaProprietate('${categoria}', ${index}, 'nume', this.value)"></td>
                    <td><input type="number" class="quantity-input" value="${produs.cantitate_per_pers}" step="0.01" onchange="actualizeazaProprietate('${categoria}', ${index}, 'cantitate_per_pers', parseFloat(this.value) || 0)"></td>
                    <td>
                        <select class="profile-select" onchange="actualizeazaProprietate('${categoria}', ${index}, 'profil', this.value)">
                            <option value="normal" ${produs.profil === 'normal' ? 'selected' : ''}>Normal</option>
                            <option value="mancacios" ${produs.profil === 'mancacios' ? 'selected' : ''}>M√¢ncƒÉcios</option>
                            <option value="vegetarian" ${produs.profil === 'vegetarian' ? 'selected' : ''}>Vegetarian</option>
                            <option value="copil" ${produs.profil === 'copil' ? 'selected' : ''}>Copil</option>
                        </select>
                    </td>
                    <td><input type="text" class="editable-input" value="${produs.unitate}" onchange="actualizeazaProprietate('${categoria}', ${index}, 'unitate', this.value)"></td>
                    <td><input type="number" class="price-input" value="${produs.pret}" step="0.01" onchange="actualizeazaProprietate('${categoria}', ${index}, 'pret', parseFloat(this.value) || 0)"></td>
                    <td><input type="number" class="time-input" value="${produs.timp_preparare}" min="0" onchange="actualizeazaProprietate('${categoria}', ${index}, 'timp_preparare', parseInt(this.value) || 0)"></td>
                    <td><input type="checkbox" onchange="actualizeazaProprietate('${categoria}', ${index}, 'am_acasa', this.checked)" ${produs.am_acasa ? 'checked' : ''}></td>
                    <td><input type="text" class="notes-input" value="${produs.notite}" onchange="actualizeazaProprietate('${categoria}', ${index}, 'notite', this.value)"></td>
                    <td class="total-price">${totalProdus} LEI</td>
                    <td class="action-cell"><button class="delete-btn" onclick="stergeProdus('${categoria}', ${index})">»òterge</button></td>
                `;
            });
        }

        function actualizeazaProprietate(categoria, index, proprietate, valoareNoua) {
            produse[categoria][index][proprietate] = valoareNoua;
            actualizeazaToate();
        }

        function adaugaProdus(categoria) {
            const profilInitial = document.getElementById('profilInitial').value;
            const produs = {
                nume: "Produs nou",
                cantitate_per_pers: 0.1,
                unitate: "buc",
                pret: 1,
                profil: profilInitial,
                timp_preparare: 0,
                am_acasa: false,
                notite: ""
            };
            produse[categoria].push(produs);
            actualizeazaToate();
        }

        function stergeProdus(categoria, index) {
            if (confirm('Sigur vrei sƒÉ »ôtergi acest produs?')) {
                produse[categoria].splice(index, 1);
                actualizeazaToate();
            }
        }

        function calculeazaTotalCheltuieli() {
            const nr_persoane = parseInt(document.getElementById('persoane').value) || 0;
            let total = 0;

            Object.values(produse).forEach(categorie => {
                categorie.forEach(produs => {
                    if (!produs.am_acasa) { // Include doar produsele care nu sunt "acasƒÉ"
                        const cantitateCalculata = calculeazaCantitate(produs.cantitate_per_pers, nr_persoane, produs.profil);
                        total += cantitateCalculata * produs.pret;
                    }
                });
            });
            return total;
        }

        function actualizeazaBuget() {
            const bugetTotal = parseFloat(document.getElementById('buget').value) || 0;
            const totalCheltuieli = calculeazaTotalCheltuieli();
            const baniRamasi = bugetTotal - totalCheltuieli;

            document.getElementById('totalBuget').textContent = `${bugetTotal.toFixed(2)} LEI`;
            document.getElementById('totalCheltuieli').textContent = `${totalCheltuieli.toFixed(2)} LEI`;
            document.getElementById('baniRamasi').textContent = `${baniRamasi.toFixed(2)} LEI`;

            const budgetSummary = document.getElementById('budgetSummary');
            if (baniRamasi < 0) {
                budgetSummary.classList.add('warning');
            } else {
                budgetSummary.classList.remove('warning');
            }
        }

        function actualizeazaToate() {
            actualizeazaTabela('carneTable', produse.carne, 'carne');
            actualizeazaTabela('legumeTable', produse.legume, 'legume');
            actualizeazaTabela('bauturiTable', produse.bauturi, 'bauturi');
            actualizeazaTabela('condimenteTable', produse.condimente, 'condimente');
            actualizeazaBuget();
        }

        function sorteazaTabel(categoria, cheie) {
            produse[categoria].sort((a, b) => {
                if (typeof a[cheie] === 'string') {
                    return a[cheie].localeCompare(b[cheie]);
                }
                return a[cheie] - b[cheie];
            });
            actualizeazaTabela(categoria + 'Table', produse[categoria], categoria);
        }

        function salveazaPlan() {
            const dataToSave = {
                persoane: document.getElementById('persoane').value,
                buget: document.getElementById('buget').value,
                produse: produse
            };
            localStorage.setItem('gratarPlan', JSON.stringify(dataToSave));
            alert('Planul a fost salvat local!');
        }

        function incarcaPlan() {
            const savedData = localStorage.getItem('gratarPlan');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('persoane').value = data.persoane;
                document.getElementById('buget').value = data.buget;
                produse = data.produse;
                actualizeazaToate();
                alert('Planul a fost √ÆncƒÉrcat din stocarea localƒÉ!');
            } else {
                alert('Nu s-a gƒÉsit niciun plan salvat local.');
            }
        }

        function exportaJSON() {
            const dataToExport = {
                persoane: document.getElementById('persoane').value,
                buget: document.getElementById('buget').value,
                produse: produse
            };
            const filename = `plan_gratar_${new Date().toISOString().slice(0, 10)}.json`;
            const jsonStr = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importaJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            if (importedData.persoane && importedData.buget && importedData.produse) {
                                document.getElementById('persoane').value = importedData.persoane;
                                document.getElementById('buget').value = importedData.buget;
                                produse = importedData.produse;
                                actualizeazaToate();
                                alert('Planul a fost importat cu succes!');
                            } else {
                                throw new Error('Fi»ôier JSON invalid pentru planul de grƒÉtar.');
                            }
                        } catch (error) {
                            alert('Eroare la importarea fi»ôierului: ' + error.message);
                            console.error(error);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function genereazaListaCumparaturi() {
            const nr_persoane = parseInt(document.getElementById('persoane').value) || 0;
            const lista = {};
            let totalLista = 0;

            Object.values(produse).forEach(categorie => {
                categorie.forEach(produs => {
                    if (!produs.am_acasa) { // Doar ce nu e deja "acasƒÉ"
                        const cantitateNecesara = calculeazaCantitate(produs.cantitate_per_pers, nr_persoane, produs.profil);
                        const pretTotalProdus = cantitateNecesara * produs.pret;

                        if (lista[produs.nume]) {
                            lista[produs.nume].cantitate += cantitateNecesara;
                            lista[produs.nume].pretTotal += pretTotalProdus;
                        } else {
                            lista[produs.nume] = {
                                cantitate: cantitateNecesara,
                                unitate: produs.unitate,
                                pretTotal: pretTotalProdus
                            };
                        }
                        totalLista += pretTotalProdus;
                    }
                });
            });

            const shoppingListContent = document.getElementById('shoppingListContent');
            shoppingListContent.innerHTML = ''; // Clear previous list

            for (const numeProdus in lista) {
                const item = lista[numeProdus];
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${numeProdus}: <strong>${item.cantitate.toFixed(2)} ${item.unitate}</strong></span>
                    <span>${item.pretTotal.toFixed(2)} LEI</span>
                `;
                shoppingListContent.appendChild(li);
            }
            document.getElementById('shoppingListTotal').textContent = `${totalLista.toFixed(2)} LEI`;
            document.getElementById('shoppingListModal').style.display = 'flex'; // Show modal
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Event listeners
        document.getElementById('persoane').addEventListener('input', actualizeazaToate);
        document.getElementById('buget').addEventListener('input', actualizeazaBuget);

        // Ini»õializare
        actualizeazaToate();
    </script>
</body>
</html>